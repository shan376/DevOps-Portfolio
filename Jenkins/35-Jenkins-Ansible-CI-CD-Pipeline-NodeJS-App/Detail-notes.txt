ğŸ“˜ Jenkins + Ansible Integration (Complete Notes)
________________________________________
ğŸ”· ğŸ§  Conceptual Understanding (Roman Urdu)
Ansible ek configuration management tool hai jo servers configure karta hai aur apps ko deploy karne mein help karta hai.
Jenkins ek automation server hai jo jab bhi koi code GitHub pe push ho, to automatically tasks run kar sakta hai (jaise build, test, deploy).
ğŸ”— Integration ka faida:
Jenkins code push detect karta hai â†’ Ansible playbook auto-run hoti hai â†’ app deploy ho jata hai bina manual kaam ke.
________________________________________
ğŸ’¡ Zarurat Kyun Hai? (Need in Roman Urdu)
â€¢	Manual deployment har dafa time-consuming aur risky hoti hai.
â€¢	Jenkins + Ansible se automation aata hai.
â€¢	Har code change par app automatic deploy ho jati hai = ğŸ’¯ CI/CD workflow
________________________________________
ğŸ” Real-Life Example (Roman Urdu)
Maal lijiye aapki ek web app hai GitHub par. Jab developer main branch me naye features push karta hai, Jenkins use detect karta hai aur Ansible ko bolta hai ke nayi deployment karo.
Ansible turant server pe deploy.yml playbook run karta hai jo app update kar deta hai â€” bina manual intervention ke.
________________________________________

ğŸ§ª Practical Lab: Jenkins + Ansible Integration
________________________________________
âœ… Step 1: Launch Ubuntu EC2 Instance (if not done)
â€¢	AMI: Ubuntu 22.04
â€¢	Instance Type: t2.medium
â€¢	Allow port 8080 in security group for Jenkins
â€¢	SSH login using PuTTY/terminal
________________________________________
âœ… Step 2: Install Java & Jenkins
Install Java (for Jenkins)
sudo apt update
sudo apt install openjdk-17-jdk -y
java -version

 Install Jenkins
# Add Jenkins repo & key
wget -q -O - https://pkg.jenkins.io/debian/jenkins.io-2023.key | sudo apt-key add -
sudo sh -c 'echo deb https://pkg.jenkins.io/debian binary/ > /etc/apt/sources.list.d/jenkins.list'

# Install Jenkins
sudo apt update
sudo apt install jenkins -y

# Start & enable Jenkins
sudo systemctl start jenkins
sudo systemctl enable jenkins
sudo systemctl status jenkins

________________________________________
âœ… Step 3: Access Jenkins Web UI
ğŸ”— Visit:
http://<your-ec2-public-ip>:8080
ğŸ”‘ Unlock Jenkins:
sudo cat /var/lib/jenkins/secrets/initialAdminPassword
â¡ï¸ Setup wizard â†’ Install Suggested Plugins â†’ Create Admin User â†’ Dashboard Ready
________________________________________
âœ… Step 4: Install Ansible on Jenkins Server
sudo apt update
sudo apt install ansible -y
________________________________________
âœ… Step 5: Allow Jenkins to Run Ansible (Give Sudo)
sudo usermod -aG sudo jenkins
sudo visudo
ğŸ‘‡ Add at bottom:
jenkins ALL=(ALL) NOPASSWD: ALL
________________________________________
âœ… Step 6: Create Jenkinsfile & Ansible Playbook
mkdir jenkins-ansible-lab
cd jenkins-ansible-lab
ğŸ“„ deploy.yml â€” Ansible Playbook
- hosts: localhost
  tasks:
    - name: Create a file to simulate app deployment
      file:
        path: /tmp/app-deployed.txt
        state: touch
ğŸ“„ Jenkinsfile â€” Pipeline Script
pipeline {
  agent any

  environment {
    ANSIBLE_HOST_KEY_CHECKING = 'False'
  }

  stages {
    stage('Run Ansible') {
      steps {
        sh 'ansible-playbook deploy.yml'
      }
    }
  }
}
________________________________________
âœ… Step 7: Push Project to GitHub
ğŸ“¦ Initialize Git Repo & Push
git init
git add .
git commit -m "Initial Jenkins + Ansible pipeline"
git branch -M main
git remote add origin https://github.com/shan376/jenkins-ansible-lab.git
git push -u origin main
ğŸ” If private repo: Use GitHub Personal Access Token
________________________________________
âœ… Step 8: Add GitHub Credentials to Jenkins
1.	Jenkins Dashboard â†’ Manage Jenkins
2.	â†’ Credentials â†’ Global â†’ Add Credentials
3.	Select:
o	Kind: Username with Password
o	Username: your_github_username
o	Password: GitHub PAT (token)
o	ID: github-creds
4.	Save
________________________________________
âœ… Step 9: Create Jenkins Pipeline Job
1.	Jenkins Dashboard â†’ New Item
2.	Name: ansible-deploy-pipeline
3.	Type: Pipeline
4.	In Configuration:
o	Pipeline â†’ Definition: Pipeline script from SCM
o	SCM: Git
o	Repository URL:
o	https://github.com/<your-username>/jenkins-ansible-lab.git
o	Credentials: Select github-creds
o	Branch Specifier: */main
5.	âœ… Save
________________________________________
âœ… Step 10: Run Jenkins Job (Manual Trigger)
1.	Go to Job Dashboard
2.	Click Build Now
3.	Console Output â†’ Check for Ansible success
4.	SSH terminal:
ls -l /tmp/app-deployed.txt
ğŸ‰ If file exists â†’ your deployment via Jenkins + Ansible is successful!
________________________________________
âœ… Step 11: Setup GitHub Webhook for Auto Trigger
ğŸ§° GitHub Side:
1.	Go to GitHub Repo â†’ Settings â†’ Webhooks â†’ Add Webhook
2.	Fill:
o	Payload URL:
o	http://<your-ec2-public-ip>:8080/github-webhook/
o	Content type: application/json
o	Event: Just the push event
3.	Save
ğŸ§° Jenkins Side:
1.	Go to Job â†’ Configure
2.	Tick â€œGitHub hook trigger for GITScm pollingâ€
3.	Save
________________________________________
âœ… Final Test
1.	Make any change in code (like Jenkinsfile or playbook)
2.	Push it to GitHub
3.	Jenkins auto-triggers
4.	/tmp/app-deployed.txt gets updated
________________________________________
ğŸ§¾ Summary (Roman Urdu):
ğŸ”§ Task	Roman Urdu
Jenkins Install	Jenkins ko EC2 pe install kia
Ansible Install	Ansible Jenkins server pe install kia
Playbook banaaya	deploy.yml jo file create karta hai
Jenkinsfile likha	Jo Ansible playbook run karta hai
GitHub push kia	Code ko GitHub repo pe dala
Jenkins job banai	GitHub repo se pipeline trigger karne wali
Webhook setup kia	GitHub â†’ Jenkins auto trigger setup
________________________________________


Assignment
ğŸ”° Final Notes: Jenkins CI/CD Pipeline with Ansible & Docker (Node.js App)
ğŸ§± Infrastructure Setup
1. Launch 2 EC2 Instances (Ubuntu 22.04 LTS)
Instance Name	Purpose	Type	Ports to Open
Jenkins Server	CI/CD Tool	t2.medium	22, 8080
App Server (Target)	App Deployment	t2.micro	22, 3000
________________________________________
â˜ï¸ Jenkins Server Setup (Instance 1)
2. SSH & Install Required Tools
Connect via terminal (Jenkins EC2):
ssh -i "jenkins-key.pem" ubuntu@<Jenkins-EC2-IP>

Install Java (for Jenkins)
sudo apt update
sudo apt install openjdk-17-jdk -y
java -version
3. Install Jenkins
# Add Jenkins repo & key
wget -q -O - https://pkg.jenkins.io/debian/jenkins.io-2023.key | sudo apt-key add -
sudo sh -c 'echo deb https://pkg.jenkins.io/debian binary/ > /etc/apt/sources.list.d/jenkins.list'

# Install Jenkins
sudo apt update
sudo apt install jenkins -y

# Start & enable Jenkins
sudo systemctl start jenkins
sudo systemctl enable jenkins
sudo systemctl status jenkins

ğŸŒ Jenkins URL:
http://your-public-ip:8080
ğŸ“ To get initial admin password:
sudo cat /var/lib/jenkins/secrets/initialAdminPassword
________________________________________
4. Install Git, Ansible & Docker (Locally)
sudo apt install -y git ansible docker.io
sudo usermod -aG docker jenkins
âœ… Reboot or logout/login for Docker group changes to apply if needed.
________________________________________
ğŸ§ª Target Node Setup (App Server - Instance 2)
5. Install Docker
sudo apt update -y
sudo apt install -y docker.io
sudo systemctl start docker
sudo systemctl enable docker
________________________________________
ğŸ” Step 6: Copy .pem Key to Jenkins Server using WinSCP (âœ… REPLACEMENT FOR SSH-KEYGEN)
ğŸ”„ Skip ssh-keygen â€“ instead:
ğŸ”¹ Upload .pem key to Jenkins Server:
1.	Open WinSCP
2.	Connect to Jenkins EC2 using ubuntu and jenkins-key.pem
3.	Upload your Target EC2's .pem key (e.g., deployement-server.pem) to Jenkins server:
o	Destination: /var/lib/jenkins/.ssh/deployement-server.pem
4.	Set permissions via SSH:
# 1. Move the PEM key to Jenkins's .ssh folder
sudo mkdir -p /var/lib/jenkins/.ssh
sudo mv /home/ubuntu/1stdep.pem /var/lib/jenkins/.ssh/1stdep.pem
# 2. Set ownership to jenkins user
sudo chown jenkins:jenkins /var/lib/jenkins/.ssh/1stdep.pem
# 3. Set correct permissions
sudo chmod 600 /var/lib/jenkins/.ssh/1stdep.pem
Now Jenkins can SSH into the target using this .pem.
________________________________________
ğŸ“ GitHub Repo Structure
myrepo35/
â”œâ”€â”€ inventory.ini
â”œâ”€â”€ playbook.yml     âœ…
â”œâ”€â”€ Jenkinsfile
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ package.json
â”œâ”€â”€ index.js
________________________________________
âœ… inventory.ini
[web]
<target-ec2-public-ip> ansible_user=ubuntu ansible_ssh_private_key_file=/var/lib/jenkins/.ssh/deployement-server-key.pem
________________________________________
âœ… playbook.yml
- name: Deploy App using Docker
  hosts: web
  become: true
  tasks:
    - name: Install Docker
      apt:
        name: docker.io
        state: present
        update_cache: true

    - name: Clone App Repo
      git:
        repo: https://github.com/shan376/repo1.git
        dest: /home/ubuntu/app
        force: yes

    - name: Build Docker Image
      command: docker build -t myapp:latest .
      args:
        chdir: /home/ubuntu/app

    - name: Stop Running Container (if any)
      command: docker stop myapp
      ignore_errors: yes

    - name: Run Docker Container
      command: docker run -d -p 3000:3000 --name myapp myapp:latest
________________________________________
âœ… Jenkinsfile
pipeline {
    agent any
    environment {
        ANSIBLE_HOST_KEY_CHECKING = 'False'
        SSH_DIR = "${env.WORKSPACE}/.ssh"
    }
    stages {
        stage('Clone Repo') {
            steps {
                checkout([$class: 'GitSCM',
                    branches: [[name: '*/main']],
                    userRemoteConfigs: [[
                        url: 'https://github.com/shan376/repo.git',
                        credentialsId: 'put your credential id'
                    ]]
                ])
            }
        }

        stage('Run Ansible') {
            steps {
                withCredentials([file(credentialsId: 'ansible_key', variable: 'PEM_FILE')]) {
                    sh '''
                        mkdir -p $SSH_DIR
                        chmod 700 $SSH_DIR

                        cp $PEM_FILE $SSH_DIR/app-server.pem
                        chmod 600 $SSH_DIR/app-server.pem

                        ssh-keyscan -H deployement-server-ip >> $SSH_DIR/known_hosts

                        ansible-playbook -i inventory.ini playbook.yml \
                          --private-key=$SSH_DIR/app-server.pem
                    '''
                }
            }
        }
    }
}
________________________________________
âœ… Dockerfile
FROM node:16
WORKDIR /app
COPY . .
RUN npm install
CMD ["npm", "start"]
________________________________________
âœ… package.json
{
  "name": "myapp",
  "version": "1.0.0",
  "description": "Simple Node App",
  "main": "index.js",
  "scripts": {
    "start": "node index.js",
    "test": "echo \"Test passed\" && exit 0",
    "build": "echo \"Build successful\""
  },
  "dependencies": {
    "express": "^4.18.2"
  }
}
________________________________________
âœ… index.js
const express = require('express');
const app = express();

app.get('/', (req, res) => {
  res.send("Hello from Jenkins + Ansible + Docker!");
});

app.listen(3000, () => {
  console.log('App running on port 3000');
});
________________________________________

Push to GitHub
git init
git remote add origin https://github.com/shan376/repo1.git
git add .
git commit -m "all file for commit"
git branch -M main
git push -u origin main
ğŸ”— Jenkins Pipeline Configuration
1.	Create New Item â†’ Pipeline
2.	Set:
o	SCM: Git
o	URL: https://github.com/shan376/repo1.git
o	Credentials: GitHub PAT
o	Branch: */main
Use Jenkins Credentials (Secure Way)
1.	Go to Jenkins â†’ Manage Jenkins â†’ Credentials
2.	Add a new credential:
o	Kind: Secret file
o	ID: ansible_key
o	File: Upload your 1stdep.pem
Open configuration of your pipeline and go to trigger section select as
âœ…  GitHub hook trigger for GITScm polling
________________________________________
ğŸ” Auto Deployment via GitHub Webhook (Optional)
1.	GitHub â†’ Settings â†’ Webhooks
2.	URL: http://<jenkins-public-ip>:8080/github-webhook/
3.	Content type: application/json
4.	Trigger: â€œJust the push eventâ€
5.	Jenkins Job Config â†’ Enable â€œGitHub hook trigger for GITScm pollingâ€
________________________________________
âœ… Final Testing
1.	Modify index.js or package.json and push to GitHub
2.	Jenkins pipeline triggers â†’ Ansible runs â†’ App deployed
ğŸŒ Visit App:
http://<target-ec2-ip>:3000
Expected Output:
Hello from Jenkins + Ansible + Docker!
________________________________________
```

