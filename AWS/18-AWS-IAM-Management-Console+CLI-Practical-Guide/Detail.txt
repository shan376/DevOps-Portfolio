ğŸ“˜ DevOps Notes â€“ Topic 18: IAM Management (Console + CLI Version)
ğŸ¯ Goal:
Securely manage access to AWS resources using IAM via both Console and CLI.
ğŸ”¹ 1. What is IAM?
ğŸ“Œ Concept:
IAM (Identity and Access Management) allows you to manage who can access what in AWS â€” securely.
ğŸ“˜ Roman Urdu:
IAM ka kaam hai AWS account mein users, groups aur unki permissions ko manage karna â€” jise access control kehte hain.

ğŸ”¹ 2. IAM Components
Component Console Example CLI Equivalent
User Individual login (username/password or API key) aws iam create-user
Group Collection of users with same policy aws iam create-group
Policy Rules defining permissions (JSON-based) aws iam create-policy
Role Temporary access for AWS services aws iam create-role

ğŸ“˜ Roman Urdu CLI Concept:
â€¢ User: AWS pe kaam karne wala banda
â€¢ Group: Users ka group jise same rule dena hai
â€¢ Policy: Ek permission ka JSON document
â€¢ Role: Temporary permission (e.g., EC2 ko S3 access dena)

ğŸ§ª Practical Work â€“ IAM Lab (CLI Based)
âœ… LAB: Create IAM User, Group, and Generate Access Key (CLI Based)
ğŸ§ª Pre-requisite: AWS CLI must be configured (using aws configure with root credentials)

ğŸ”¹ Step 1: Create IAM Group
aws iam create-group --group-name cli-group
ğŸ“˜ Roman Urdu:
Ye command ek naya group cli-group banata hai IAM ke andar.

ğŸ”¹ Step 2: Attach Policy to Group
aws iam attach-group-policy \
--group-name cli-group \
--policy-arn arn:aws:iam::aws:policy/AmazonS3ReadOnlyAccess
ğŸ“˜ Roman Urdu:
Ye command cli-group ko Amazon S3 read-only access deti hai. Aap chahein to koi aur policy bhi attach kar sakte hain jaise EC2FullAccess.

ğŸ”¹ Step 3: Create IAM User
aws iam create-user --user-name cli-user
ğŸ“˜ Roman Urdu:
Ye command cli-user naam ka ek new IAM user banata hai.

ğŸ”¹ Step 4: Add User to Group
aws iam add-user-to-group \
--user-name cli-user \
--group-name cli-group
ğŸ“˜ Roman Urdu:
Ab hum user cli-user ko group cli-group me daal rahe hain jisme policy attached hai.

ğŸ”¹ Step 5: Create Access Key (Programmatic Access)
aws iam create-access-key --user-name cli-user
ğŸ“˜ Roman Urdu:
Is command se aapko AccessKeyId aur SecretAccessKey milega jo CLI ke liye use hota hai.

âœ… Output Example:
{
"AccessKey": {
"UserName": "cli-user",
"AccessKeyId": "AKIAIOSFODNN7EXAMPLE",
"Status": "Active",
"SecretAccessKey": "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY",
"CreateDate": "2025-05-24T12:00:00Z"
}
}

ğŸ“ Save this AccessKeyId and SecretAccessKey safely â€“ yeh keys baad mein aws configure ke liye use hongi.

ğŸ“¦ Lab Summary (Cheat Sheet)
Task CLI Command
Create IAM Group aws iam create-group --group-name cli-group
Attach Policy aws iam attach-group-policy --group-name cli-group --policy-arn arn:aws:iam::aws:policy/AmazonS3ReadOnlyAccess
Create IAM User aws iam create-user --user-name cli-user
Add User to Group aws iam add-user-to-group --user-name cli-user --group-name cli-group
Create Access Key aws iam create-access-key --user-name cli-user

ğŸ” AWS IAM Least Privilege Lab â€“ Custom Policy Practice
IAM User: myiamuser
Policy Name: mypolicy
Policy File: mypolicy.json

Step 1: Create IAM User
aws iam create-user --user-name myiamuser

Step 2: Create Policy JSON using nano
nano mypolicy.json
Paste the following:
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Action": [
"ec2:StartInstances",
"ec2:StopInstances"
],
"Resource": "*"
}
]
}

ğŸ“˜ Save the file:
Ctrl + O, Enter, Ctrl + X

Step 3: Create the Policy in AWS
aws iam create-policy --policy-name mypolicy --policy-document file://mypolicy.json
ğŸ“ Note the output ARN, e.g.:
arn:aws:iam::123456789012:policy/mypolicy

Step 4: Attach Policy to User
aws iam attach-user-policy --user-name myiamuser --policy-arn arn:aws:iam::123456789012:policy/mypolicy
ğŸ‘‰ Replace ARN with your actual output.

Step 5: Generate Access Key
aws iam create-access-key --user-name myiamuser
ğŸ“ Save the keys securely for CLI use.

Step 6: Configure AWS CLI with Profile
aws configure --profile myiamuser
Fill in:
â€¢ AWS Access Key ID
â€¢ AWS Secret Access Key
â€¢ Default region (e.g., us-east-1)
â€¢ Output format (json)

Step 7: Test Permissions
âŒ Denied: Describe Instances
aws ec2 describe-instances --profile myiamuser
âœ… Allowed: Start Instance
aws ec2 start-instances --instance-ids <INSTANCE_ID> --profile myiamuser
âœ… Allowed: Stop Instance
aws ec2 stop-instances --instance-ids <INSTANCE_ID> --profile myiamuser
âŒ Denied: Terminate Instance
aws ec2 terminate-instances --instance-ids <INSTANCE_ID> --profile myiamuser

âœ… Ready to Use!
Bas instance ID change karna hota hai jab bhi test karna ho.

âœ… IAM Management via AWS Console
ğŸ¯ Goal: Securely manage access to AWS using IAM via Console

ğŸ”¹ Step 1: Create IAM Group (Console)
1. AWS Console me login karein.
2. Top pe search karein: IAM
3. Left sidebar se User groups pe click karein.
4. Create group pe click karein.
5. Group Name dein: cli-group
6. Policies attach karne ka option aayega â€” abhi skip kar dein ya next step me karein.
7. Create group button pe click karein.
ğŸ“˜ Roman Urdu: Console me â€œIAMâ€ open karo, phir "User groups" me jaake naya group banao cli-group naam ka.

ğŸ”¹ Step 2: Attach Policy to Group (Console)
1. IAM Dashboard se User groups open karein.
2. Apna group cli-group select karein.
3. Tab me jaayein: Permissions â†’ click on Add permissions
4. Attach policies directly option choose karein.
5. Policy search karein: AmazonS3ReadOnlyAccess ya koi bhi chahein.
6. Checkbox select karein â†’ Next â†’ Add permissions
ğŸ“˜ Roman Urdu: Group me jaake â€œAdd permissionsâ€ karo aur required policy attach kar do.

ğŸ”¹ Step 3: Create IAM User (Console)
1. IAM Dashboard â†’ Users tab pe click karein.
2. Add user pe click karein.
3. User name dein: cli-user
4. Access type select karein:
âœ… Programmatic access (for CLI access)
âŒ Console access (optional)
5. Next: Permissions â†’ abhi group se add karenge.
6. Next karke user banayein.
ğŸ“˜ Roman Urdu: IAM ke "Users" section me jaake cli-user create karo sirf CLI access ke liye.

ğŸ”¹ Step 4: Add User to Group (Console)
1. IAM Dashboard â†’ Users â†’ cli-user select karein.
2. Tab me jaayein: Groups â†’ click on Add user to group
3. cli-group select karein â†’ Add to group
ğŸ“˜ Roman Urdu: Ye step user ko us group me add karta hai jisme policy lagi hai.

ğŸ”¹ Step 5: Create Access Key (Console)
1. IAM Dashboard â†’ Users â†’ click on cli-user
2. Tab: Security credentials
3. Section: Access keys â†’ click on Create access key
4. Purpose select karein (e.g., CLI use), then Next
5. Create access key pe click karein
6. Aapko mil jayega:
Access key ID
Secret access key
ğŸ“˜ Roman Urdu: CLI use ke liye ye 2 keys copy karke safe jagah rakh lo, aws configure me use hongi.

âœ… IAM Custom Policy (Least Privilege) via Console
ğŸ¯ Goal: Sirf EC2 Start/Stop permission dena myiamuser ko

ğŸ”¹ Step 1: Create IAM User
1. IAM â†’ Users â†’ Add user
2. Name: myiamuser
3. Access type: Programmatic access â†’ Next
4. Permissions: Abhi skip ya custom denge â†’ Next â†’ Create User

ğŸ”¹ Step 2: Create Custom Policy
1. IAM Dashboard â†’ Policies â†’ Create policy
2. Tab: JSON
3. Paste below policy:
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Action": [
"ec2:StartInstances",
"ec2:StopInstances"
],
"Resource": "*"
}
]
}
4. Click on Next
5. Name dein: mypolicy
6. Create policy pe click karein
ğŸ“˜ Roman Urdu: Ye policy sirf EC2 start aur stop karne ki permission degi.

ğŸ”¹ Step 3: Attach Policy to User
1. IAM â†’ Users â†’ click on myiamuser
2. Tab: Permissions â†’ Add permissions
3. Select: Attach policies directly
4. Search karein: mypolicy
5. Select karein â†’ Next â†’ Add permissions

ğŸ”¹ Step 4: Create Access Key for myiamuser
1. IAM â†’ Users â†’ myiamuser â†’ Security credentials
2. Create access key â†’ Purpose: CLI use
3. AccessKeyId aur SecretAccessKey save karo.

ğŸ”¹ Step 5: Configure AWS CLI with These Keys
CLI me run karein:
aws configure --profile myiamuser
Inputs dein:
â€¢ Access Key ID: (jo console se mila)
â€¢ Secret Access Key: (jo console se mila)
â€¢ Region: apni region e.g., us-west-1
â€¢ Output: json

ğŸ”¹ Step 6: Test Permissions
CLI me run karein:
aws ec2 describe-instances --profile myiamuser # âŒ Denied
aws ec2 start-instances --instance-ids i-xyz --profile myiamuser # âœ… Allowed
aws ec2 stop-instances --instance-ids i-xyz --profile myiamuser # âœ… Allowed
aws ec2 terminate-instances --instance-ids i-xyz --profile myiamuser # âŒ Denied

âœ… Summary Table â€” IAM via Console
Task Console Steps
Create Group IAM â†’ User groups â†’ Create group
Attach Policy IAM â†’ Groups â†’ Permissions â†’ Add policy
Create User IAM â†’ Users â†’ Add user
Add User to Group User â†’ Groups â†’ Add to group
Create Access Key User â†’ Security credentials â†’ Create access key
Create Policy IAM â†’ Policies â†’ Create policy (JSON)
Attach Policy to User User â†’ Permissions â†’ Add policy
Configure CLI aws configure --profile myiamuser

