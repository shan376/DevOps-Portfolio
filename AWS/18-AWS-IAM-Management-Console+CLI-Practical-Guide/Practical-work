ğŸ“˜ Practical Work â€“ IAM Management (Console + CLI)

ğŸ§ª Practical Work â€“ IAM Lab (CLI Based)

âœ… LAB: Create IAM User, Group, and Generate Access Key (CLI Based)

ğŸ§ª Pre-requisite:
AWS CLI must be configured (using aws configure with root credentials)

ğŸ”¹ Step 1: Create IAM Group
aws iam create-group --group-name cli-group

ğŸ”¹ Step 2: Attach Policy to Group
aws iam attach-group-policy \
--group-name cli-group \
--policy-arn arn:aws:iam::aws:policy/AmazonS3ReadOnlyAccess

ğŸ”¹ Step 3: Create IAM User
aws iam create-user --user-name cli-user

ğŸ”¹ Step 4: Add User to Group
aws iam add-user-to-group \
--user-name cli-user \
--group-name cli-group

ğŸ”¹ Step 5: Create Access Key (Programmatic Access)
aws iam create-access-key --user-name cli-user

âœ… Output Example:
{
"AccessKey": {
"UserName": "cli-user",
"AccessKeyId": "AKIAIOSFODNN7EXAMPLE",
"Status": "Active",
"SecretAccessKey": "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY",
"CreateDate": "2025-05-24T12:00:00Z"
}
}

ğŸ“ Save this AccessKeyId and SecretAccessKey safely â€“ they will be used later in aws configure.

ğŸ“¦ Lab Summary (Cheat Sheet)
Task                            CLI Command
Create IAM Group                aws iam create-group --group-name cli-group
Attach Policy                   aws iam attach-group-policy --group-name cli-group --policy-arn arn:aws:iam::aws:policy/AmazonS3ReadOnlyAccess
Create IAM User                 aws iam create-user --user-name cli-user
Add User to Group               aws iam add-user-to-group --user-name cli-user --group-name cli-group
Create Access Key               aws iam create-access-key --user-name cli-user


ğŸ” AWS IAM Least Privilege Lab â€“ Custom Policy Practice

IAM User: myiamuser  
Policy Name: mypolicy  
Policy File: mypolicy.json  

Step 1: Create IAM User
aws iam create-user --user-name myiamuser

Step 2: Create Policy JSON using nano
nano mypolicy.json

Paste the following:
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Action": [
"ec2:StartInstances",
"ec2:StopInstances"
],
"Resource": "*"
}
]
}

Save the file:
Ctrl + O, Enter, Ctrl + X

Step 3: Create the Policy in AWS
aws iam create-policy --policy-name mypolicy --policy-document file://mypolicy.json

ğŸ“ Note the output ARN, e.g.:
arn:aws:iam::123456789012:policy/mypolicy

Step 4: Attach Policy to User
aws iam attach-user-policy --user-name myiamuser --policy-arn arn:aws:iam::123456789012:policy/mypolicy
ğŸ‘‰ Replace ARN with your actual output.

Step 5: Generate Access Key
aws iam create-access-key --user-name myiamuser
ğŸ“ Save the keys securely for CLI use.

Step 6: Configure AWS CLI with Profile
aws configure --profile myiamuser

Fill in:
â€¢ AWS Access Key ID
â€¢ AWS Secret Access Key
â€¢ Default region (e.g., us-east-1)
â€¢ Output format (json)

Step 7: Test Permissions
âŒ Denied: Describe Instances
aws ec2 describe-instances --profile myiamuser

âœ… Allowed: Start Instance
aws ec2 start-instances --instance-ids <INSTANCE_ID> --profile myiamuser

âœ… Allowed: Stop Instance
aws ec2 stop-instances --instance-ids <INSTANCE_ID> --profile myiamuser

âŒ Denied: Terminate Instance
aws ec2 terminate-instances --instance-ids <INSTANCE_ID> --profile myiamuser


âœ… IAM Management via AWS Console

ğŸ¯ Goal: Securely manage access to AWS using IAM via Console

ğŸ”¹ Step 1: Create IAM Group (Console)
1. AWS Console â†’ Search â€œIAMâ€
2. Go to User groups â†’ Create group
3. Group Name: cli-group
4. Click Create group

ğŸ”¹ Step 2: Attach Policy to Group (Console)
1. Open cli-group â†’ Permissions tab â†’ Add permissions
2. Choose Attach policies directly
3. Search: AmazonS3ReadOnlyAccess
4. Select and Add permissions

ğŸ”¹ Step 3: Create IAM User (Console)
1. IAM â†’ Users â†’ Add user
2. Name: cli-user
3. Access type: Programmatic access
4. Click Next and Create user

ğŸ”¹ Step 4: Add User to Group (Console)
1. IAM â†’ Users â†’ cli-user â†’ Groups tab
2. Add user to cli-group

ğŸ”¹ Step 5: Create Access Key (Console)
1. IAM â†’ Users â†’ cli-user â†’ Security credentials
2. Create access key â†’ Purpose: CLI use
3. Copy Access key ID & Secret access key


âœ… IAM Custom Policy (Least Privilege) via Console

ğŸ¯ Goal: Allow only EC2 Start/Stop permissions

ğŸ”¹ Step 1: Create IAM User
1. IAM â†’ Users â†’ Add user
2. Name: myiamuser
3. Access type: Programmatic access â†’ Create User

ğŸ”¹ Step 2: Create Custom Policy
1. IAM â†’ Policies â†’ Create policy â†’ JSON tab
2. Paste below policy:
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Action": [
"ec2:StartInstances",
"ec2:StopInstances"
],
"Resource": "*"
}
]
}
3. Name policy: mypolicy â†’ Create policy

ğŸ”¹ Step 3: Attach Policy to User
1. IAM â†’ Users â†’ myiamuser â†’ Permissions â†’ Add permissions
2. Select Attach policies directly â†’ Choose mypolicy â†’ Add permissions

ğŸ”¹ Step 4: Create Access Key for myiamuser
1. IAM â†’ Users â†’ myiamuser â†’ Security credentials
2. Create access key â†’ Purpose: CLI use
3. Save AccessKeyId and SecretAccessKey

ğŸ”¹ Step 5: Configure AWS CLI with These Keys
aws configure --profile myiamuser

Inputs:
â€¢ Access Key ID
â€¢ Secret Access Key
â€¢ Region (e.g., us-west-1)
â€¢ Output: json

ğŸ”¹ Step 6: Test Permissions
aws ec2 describe-instances --profile myiamuser  # âŒ Denied
aws ec2 start-instances --instance-ids i-xyz --profile myiamuser  # âœ… Allowed
aws ec2 stop-instances --instance-ids i-xyz --profile myiamuser   # âœ… Allowed
aws ec2 terminate-instances --instance-ids i-xyz --profile myiamuser  # âŒ Denied
