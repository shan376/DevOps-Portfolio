ğŸ“˜ Kubernetes Advanced Topics â€“  Complete Notes
________________________________________
ğŸ”¹ 1. Namespace â€“ Kya Hota Hai?
ğŸ§  Concept:
Namespace ek logical partition hoti hai Kubernetes cluster ke andar.
Yani ek cluster ke andar multiple teams ya environments alag alag kaam kar saktay hain bina kisi conflict ke.
ğŸ“ Example:
Jaisay dev, qa, prod â€“ yeh sab alag namespaces hain. Har team ka apna isolated area hota hai.
ğŸ›  Use-case:
â€¢	Jab multiple teams ek hi cluster pe kaam kar rahi hoti hain.
â€¢	Jab aap multi-environment deploy kar rahay ho (Dev/Test/Prod).
â€¢	Jab security ya RBAC apply karni ho sirf ek namespace ke andar.
________________________________________
ğŸ”¹ 2. Resource Quota â€“ Kya Hai aur Kyun Zaroori Hai?
ğŸ§  Concept:
ResourceQuota ek limit lagata hai kisi namespace pe â€” kitna CPU, memory, aur pods use kar saktay hain.
ğŸ›‘ Problem Solve Karta Hai:
Agar ResourceQuota na ho to ek team saari cluster ki resources le sakti hai (jaise QA team 100 pods chala le dev waalon ka system down ho jaye ğŸ˜…)
ğŸ’¡ Isliye Zaroori Hai:
â€¢	Fair resource distribution hota hai
â€¢	Cluster over-utilization se bacha ja sakta hai
â€¢	Production workloads ke liye resource guaranteed milti hain
________________________________________

ğŸ” Real-Life Example:
ğŸ’¼ Socho ek IT company hai jismein:
â€¢	Dev Team naye features develop karti hai
â€¢	QA Team testing karti hai
â€¢	Ops Team monitoring aur scaling handle karti hai
Yeh teenon teams ek hi Kubernetes cluster use kar rahe hain.
Ab agar inke paas alag namespaces hon (dev, qa, ops) aur un namespaces mein resource quotas defined hon to:
âœ”ï¸ Har team apni limit ke andar kaam karegi
âœ”ï¸ Kisi team ka kaam doosre pe asar nahi karega
âœ”ï¸ Cluster zyada stable aur secure rahega
________________________________________
âœ… START: Required Environment
Resource	Detail
EC2 OS	Ubuntu 22.04 LTS (Jammy Jellyfish)
Instance Type	t2.medium or higher
Public IP	Required (youâ€™ll SSH into it)
Ports	âœ… Allow in Security Group:
â€¢	22 (SSH)
â€¢	6443 (K8s API)
â€¢	8285/UDP, 8472/UDP (Flannel)
â€¢	30000â€“32767 (NodePort range â€” optional)
________________________________________
ğŸ§  GOAL:
ğŸ¯ Kubernetes from scratch
ğŸ¯ Flannel + kubeadm + CoreDNS
ğŸ¯ Namespace dev + qa
ğŸ¯ Quota applied on dev
ğŸ¯ Pod runs in dev (with resource limits)
ğŸ¯ 100% reboot-proof system
________________________________________
ğŸš€ FINAL BULLETPROOF INSTALLATION GUIDE
âœ… 1. Update & Install Docker
sudo apt update && sudo apt upgrade -y
sudo apt install -y docker.io
sudo systemctl enable docker --now
________________________________________
âœ… 2. Add Kubernetes Repo (Working v1.29)
sudo apt install -y apt-transport-https ca-certificates curl gpg
sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.29/deb/Release.key | gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg

echo "deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.29/deb/ /" | sudo tee /etc/apt/sources.list.d/kubernetes.list

sudo apt update
sudo apt install -y kubelet kubeadm kubectl cri-tools
sudo apt-mark hold kubelet kubeadm kubectl
________________________________________
âœ… 3. Enable Kernel Modules for Networking
cat <<EOF | sudo tee /etc/modules-load.d/k8s.conf
br_netfilter
EOF

sudo modprobe br_netfilter

cat <<EOF | sudo tee /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-iptables  = 1
net.bridge.bridge-nf-call-ip6tables = 1
net.ipv4.ip_forward                 = 1
EOF

sudo sysctl --system
________________________________________
âœ… 4. Disable Swap
sudo swapoff -a
sudo sed -i '/ swap / s/^/#/' /etc/fstab
________________________________________
âœ… 5. [Optional] Fix /etc/hosts if DNS fails
echo "127.0.0.1 localhost" | sudo tee /etc/hosts
echo "$(curl -s ifconfig.me) master-node" | sudo tee -a /etc/hosts
________________________________________
âœ… 6. Init Kubernetes Cluster
sudo kubeadm init --pod-network-cidr=10.244.0.0/16
âš ï¸ If you face iptables warnings, run:
sudo kubeadm init --pod-network-cidr=10.244.0.0/16 --ignore-preflight-errors=FileContent--proc-sys-net-bridge-bridge-nf-call-iptables
________________________________________
âœ… 7. Setup kubectl for current user
mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config

# OR if root user:
export KUBECONFIG=/etc/kubernetes/admin.conf
echo 'export KUBECONFIG=/etc/kubernetes/admin.conf' >> ~/.bashrc
source ~/.bashrc
________________________________________
âœ… 8. Install Flannel CNI
kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
________________________________________
âœ… 9. Verify Node & Flannel
kubectl get nodes
kubectl get pods -n kube-flannel
________________________________________
ğŸ§ª Namespace & Resource Quota
âœ… Create Namespaces
kubectl create namespace dev
kubectl create namespace qa
________________________________________
âœ… Apply ResourceQuota YAML:
ğŸªµ Step 1: Create a file dev-quota.yaml
nano dev-quota.yaml
Paste this content inside the editor:
apiVersion: v1
kind: ResourceQuota
metadata:
  name: dev-quota
  namespace: dev
spec:
  hard:
    pods: "5"
    requests.cpu: "1"
    requests.memory: "1Gi"
    limits.cpu: "2"
    limits.memory: "2Gi"
________________________________________
ğŸ’¾ Step 2: Save & Exit
â€¢	In nano: press CTRL + O â†’ Enter â†’ then CTRL + X
________________________________________
ğŸš€ Step 3: Apply the YAML to Kubernetes
kubectl apply -f dev-quota.yaml
________________________________________
ğŸ” Step 4: Verify It Was Applied
kubectl describe resourcequota dev-quota -n dev
________________________________________
ğŸŸ¢ Expected Output:
You'll see something like:
Name:       dev-quota
Namespace:  dev
...
Pods:              0/5
Requests CPU:      0/1
Requests Memory:   0/1Gi
Limits CPU:        0/2
Limits Memory:     0/2Gi
________________________________________
âœ… Deploy Pod in dev
kubectl run nginx --image=nginx -n dev
kubectl get pods -n dev
________________________________________
âœ… Test Quota Limit (optional)
kubectl run nginx2 --image=nginx -n dev
kubectl run nginx3 --image=nginx -n dev
kubectl run nginx4 --image=nginx -n dev
kubectl run nginx5 --image=nginx -n dev
kubectl run nginx6 --image=nginx -n dev   # âŒ This should fail due to quota
________________________________________
âœ… Reboot-Proof Fix
sudo systemctl enable containerd
sudo systemctl enable kubelet
________________________________________
âœ… Troubleshooting Essentials
# Check kube-apiserver status
sudo crictl ps -a | grep kube-apiserver

# Check API logs
sudo crictl logs <container_id>

# Check CoreDNS status
kubectl get pods -n kube-system
kubectl describe pod -n kube-system coredns-xxxx

# Restart everything
sudo systemctl daemon-reexec
sudo systemctl restart containerd kubelet
________________________________________
âœ… Summary Notes:
â€¢	Namespace se aap multiple teams ko cluster ke andar isolation de saktay ho.
â€¢	ResourceQuota lagana important hai taake koi bhi team zyada resource use na kare.
â€¢	Har namespace ka apna quota hota hai jismein maximum pods, CPU, memory define hoti hai.
â€¢	Real-world mein yeh concept DevOps teams, production environments aur cost-saving clusters mein bohat important hota hai.
