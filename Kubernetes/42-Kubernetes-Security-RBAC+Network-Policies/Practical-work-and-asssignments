âœ… Kubernetes Security (RBAC + Network Policies)
________________________________________
ğŸ§ª PRACTICAL WORK (Complete Lab from Scratch)
________________________________________

ğŸŸ¢ Step 1: EC2 Instance Launch
Ubuntu 22.04 LTS EC2 instance launch karo (2 vCPU, 4GB RAM).
Ports open karo:
22 (SSH), 6443 (K8s API), 4789 (VXLAN), 179 (Calico optional)
â†’ Ye setup Kubernetes cluster ke liye base banata hai.

ğŸŸ¢ Step 2: System Update & Prerequisites
sudo apt update && sudo apt upgrade -y  
sudo apt install -y ca-certificates curl gnupg lsb-release  
â†’ System ready kar rahe ho Docker aur K8s install karne ke liye.

ğŸŸ¢ Step 3: Docker Install
Docker runtime install aur enable karo:
```

sudo mkdir -p /etc/apt/keyrings
curl -fsSL [https://download.docker.com/linux/ubuntu/gpg](https://download.docker.com/linux/ubuntu/gpg) | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] [https://download.docker.com/linux/ubuntu](https://download.docker.com/linux/ubuntu) jammy stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
sudo apt update
sudo apt install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin
sudo systemctl enable docker && sudo systemctl start docker

```
â†’ Ye container runtime hai jo Kubernetes pods ko run karta hai.

ğŸŸ¢ Step 4: Kubernetes Components Install
```

sudo mkdir -p /etc/apt/keyrings
curl -fsSL [https://pkgs.k8s.io/core:/stable:/v1.30/deb/Release.key](https://pkgs.k8s.io/core:/stable:/v1.30/deb/Release.key) | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg
echo "deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] [https://pkgs.k8s.io/core:/stable:/v1.30/deb/](https://pkgs.k8s.io/core:/stable:/v1.30/deb/) /" | sudo tee /etc/apt/sources.list.d/kubernetes.list
sudo apt update
sudo apt install -y kubelet kubeadm kubectl
sudo apt-mark hold kubelet kubeadm kubectl

```
â†’ K8s ke core tools install kar diye.

ğŸŸ¢ Step 5: Disable Swap & Enable Kernel Modules
```

sudo swapoff -a
sudo sed -i '/ swap / s/^/#/' /etc/fstab
sudo modprobe overlay
sudo modprobe br_netfilter

```
â†’ Swap disable aur network modules enable kiye jisse cluster smoothly chale.

ğŸŸ¢ Step 6: Configure containerd
```

sudo apt install -y containerd
sudo mkdir -p /etc/containerd
sudo containerd config default | sudo tee /etc/containerd/config.toml
sudo sed -i 's/SystemdCgroup = false/SystemdCgroup = true/' /etc/containerd/config.toml
sudo systemctl restart containerd && sudo systemctl enable containerd

```
â†’ containerd configure hua jo K8s ko backend support deta hai.

ğŸŸ¢ Step 7: Initialize Cluster with Calico
```

sudo kubeadm init --pod-network-cidr=192.168.0.0/16

```
â†’ Cluster initialize hua aur pod network CIDR assign hua.

ğŸŸ¢ Step 8: Setup Kubeconfig
```

mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config

```
â†’ User ko kubectl access mil gaya.

ğŸŸ¢ Step 9: Install Calico Networking
```

kubectl apply -f [https://docs.projectcalico.org/manifests/calico.yaml](https://docs.projectcalico.org/manifests/calico.yaml)

```
â†’ Calico pods ke IP aur policies manage karta hai.

ğŸŸ¢ Step 10: Install NGINX Ingress Controller
```

kubectl apply -f [https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.9.1/deploy/static/provider/cloud/deploy.yaml](https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.9.1/deploy/static/provider/cloud/deploy.yaml)

```
â†’ Ye external traffic ko handle karta hai.

________________________________________
ğŸ” RBAC & NETWORK POLICY IMPLEMENTATION
________________________________________

ğŸŸ¢ Step 11: Namespace Create
```

kubectl create namespace dev

```
â†’ RBAC aur Network Policy ke liye alag dev namespace banaya.

ğŸŸ¢ Step 12: Create Role (Pod Read-Only)
role.yaml:
```

apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
namespace: dev
name: pod-reader
rules:

* apiGroups: [""]
  resources: ["pods"]
  verbs: ["get", "watch", "list"]

```
Apply:
```

kubectl apply -f role.yaml

```
â†’ Ye role sirf pods ko read karne deta hai.

ğŸŸ¢ Step 13: Bind Role to User
rolebinding.yaml:
```

apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
name: read-pods-binding
namespace: dev
subjects:

* kind: User
  name: dev-user
  apiGroup: rbac.authorization.k8s.io
  roleRef:
  kind: Role
  name: pod-reader
  apiGroup: rbac.authorization.k8s.io

```
Apply:
```

kubectl apply -f rolebinding.yaml

```
â†’ dev-user ko sirf pods read karne ka access mila.

ğŸŸ¢ Step 14: Create Frontend & Backend Pods
```

kubectl create deployment frontend --image=nginx -n dev
kubectl create deployment backend --image=nginx -n dev

```
â†’ Dono sample apps deploy kiye.

ğŸŸ¢ Step 15: Apply Network Policy
network-policy.yaml:
```

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
name: allow-frontend
namespace: dev
spec:
podSelector:
matchLabels:
app: backend
ingress:

* from:

  * podSelector:
    matchLabels:
    app: frontend

```
Apply:
```

kubectl apply -f network-policy.yaml

```
â†’ Ye policy sirf frontend ko backend se baat karne degi.

ğŸŸ¢ Step 16: Verify Setup
```

kubectl get pods -n dev
kubectl get role,rolebinding -n dev
kubectl describe networkpolicy allow-frontend -n dev

```
â†’ Sab configuration verify ho gaya.

________________________________________
ğŸ§© ASSIGNMENT LAB: Kubernetes Security
________________________________________

ğŸŸ¢ Step 1: Namespace Create
```

kubectl create namespace secure-zone

```
â†’ secure-zone naam ka namespace banaya jahan security apply karenge.

ğŸŸ¢ Step 2: Deploy Frontend & Backend
```

kubectl create deployment frontend --image=nginx -n secure-zone
kubectl create deployment backend --image=nginx -n secure-zone

```

ğŸŸ¢ Step 3: Label Pods
```

kubectl label pod -n secure-zone -l app=frontend app=frontend
kubectl label pod -n secure-zone -l app=backend app=backend

```
â†’ Network policy in labels ko use karegi.

ğŸŸ¢ Step 4: RBAC Role File (role.yaml)
```

apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
namespace: secure-zone
name: pod-reader
rules:

* apiGroups: [""]
  resources: ["pods"]
  verbs: ["get", "watch", "list"]

```

ğŸŸ¢ Step 5: RoleBinding File (rolebinding.yaml)
```

apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
name: read-pods-binding
namespace: secure-zone
subjects:

* kind: User
  name: dev-user
  apiGroup: rbac.authorization.k8s.io
  roleRef:
  kind: Role
  name: pod-reader
  apiGroup: rbac.authorization.k8s.io

```

ğŸŸ¢ Step 6: Apply RBAC Files
```

kubectl apply -f role.yaml
kubectl apply -f rolebinding.yaml

```
â†’ dev-user ko sirf pods list karne ka access mila.

ğŸŸ¢ Step 7: Create Network Policy
```

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
name: allow-frontend
namespace: secure-zone
spec:
podSelector:
matchLabels:
app: backend
ingress:

* from:

  * podSelector:
    matchLabels:
    app: frontend

```
Apply:
```

kubectl apply -f network-policy.yaml

```
â†’ Sirf frontend â†’ backend communication allowed.

ğŸŸ¢ Step 8: Test Policy (Optional)
```

kubectl exec -n secure-zone -it $(kubectl get pod -n secure-zone -l app=frontend -o jsonpath='{.items[0].metadata.name}') -- /bin/bash
apt update && apt install curl -y
curl [http://backend](http://backend)

```
â†’ Frontend se backend accessible, baaki pods se blocked.

________________________________________
âœ… FINAL SUMMARY (Roman Urdu)
â€¢ Secure-zone namespace bana  
â€¢ RBAC laga ke sirf read-only access diya  
â€¢ NetworkPolicy se backend ko sirf frontend se traffic allowed  
â€¢ Cluster secure aur isolated bana successfully  
________________________________________
