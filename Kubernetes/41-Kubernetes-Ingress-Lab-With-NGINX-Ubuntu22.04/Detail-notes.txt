âœ… Kubernetes Ingress (With Full Lab + Ubuntu 22.04 )
________________________________________
ðŸ“˜ Conceptual Explanation:
ðŸ”¹ What is Ingress?
Ingress is a Kubernetes API object used to manage external HTTP/HTTPS access to services in your cluster. It lets you define rules to route traffic.
â€¢	Ingress: Path-based or host-based routing for services (e.g., /, /api, /admin)
â€¢	Ingress Controller: Software (e.g., NGINX) that processes Ingress rules and routes traffic accordingly.
________________________________________
ðŸ§  Roman Urdu Explanation:
Ingress ek traffic controller ki tarah hota hai jo decide karta hai ke external request kis service ko jayein.
Jaise agar /web aaye to web service ko bhejein, aur /api aaye to api service ko.
Aap sirf ek IP par multiple services ko run kar sakte ho different paths ke zariye.
________________________________________
ðŸ” Real-Life Example:
Socho ke aap ke paas teen apps hain:
â€¢	Frontend
â€¢	Backend
â€¢	Admin Panel
Aur aap chahte ho ke ek IP par ye teenon accessible hoon, jaise:
â€¢	/ â†’ frontend
â€¢	/api â†’ backend
â€¢	/admin â†’ admin panel
Yeh sab kaam Ingress Controller karta hai â€” bina har app ke liye separate LoadBalancer banaye.
________________________________________
ðŸ”§ Lab: Install Kubernetes + NGINX Ingress Controller on Ubuntu 22.04 (With Repo Fix)
	Required Ports
	22, 6443, 80, 443, (10250, 30000â€“32767 optional)
________________________________________
âœ… Step 1: Server Update & Prerequisites
sudo apt update && sudo apt upgrade -y
sudo apt install -y ca-certificates curl gnupg lsb-release
ðŸ§¾ Roman Urdu: System update aur curl/ca-certificates install kar rahe hain jo aage Docker aur Kubernetes ke liye required hain.
________________________________________
âœ… Step 2: Docker Install (Container Runtime ke liye)
sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu jammy stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
sudo apt update
sudo apt install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin
sudo systemctl enable docker
sudo systemctl start docker
sudo docker --version
ðŸ§¾ Roman Urdu: Docker install kar rahe hain jise Kubernetes containers run karne ke liye use karta hai.
________________________________________
âœ… Step 3: Add Kubernetes Repository (With Official Key)
sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.30/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg

echo "deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.30/deb/ /" | sudo tee /etc/apt/sources.list.d/kubernetes.list

sudo apt update

________________________________________
âœ… Step 4: Install Kubernetes Tools
sudo apt install -y kubelet kubeadm kubectl
sudo apt-mark hold kubelet kubeadm kubectl
ðŸ§¾ Roman Urdu: Ye teen basic tools hain Kubernetes ke liye â€” kubelet (node agent), kubeadm (cluster init), kubectl (command-line tool).
________________________________________
âœ… Step 5: Swap Disable Karo
sudo swapoff -a
sudo sed -i '/ swap / s/^/#/' /etc/fstab
ðŸ§¾ Roman Urdu: Kubernetes swap ko support nahi karta. Isliye permanently disable kar rahe hain.
________________________________________
âœ… Step 6: Kernel Modules & sysctl Settings
sudo modprobe overlay
sudo modprobe br_netfilter

cat <<EOF | sudo tee /etc/modules-load.d/k8s.conf
overlay
br_netfilter
EOF

cat <<EOF | sudo tee /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
net.ipv4.ip_forward = 1
EOF

sudo sysctl --system
ðŸ§¾ Roman Urdu: Networking aur IP forwarding settings configure kar rahe hain jo pods ke beech communication ke liye zaroori hai.
________________________________________
âœ… Step 7: Install aur Configure containerd
sudo apt install -y containerd
sudo mkdir -p /etc/containerd
sudo containerd config default | sudo tee /etc/containerd/config.toml
sudo sed -i 's/SystemdCgroup = false/SystemdCgroup = true/' /etc/containerd/config.toml
sudo systemctl restart containerd
sudo systemctl enable containerd
ðŸ§¾ Roman Urdu: Kubernetes ke liye containerd ko configure kar rahe hain jahan systemd cgroup mode enable karna important hai.
________________________________________
âœ… Step 8: Initialize Kubernetes Cluster
sudo kubeadm init --pod-network-cidr=192.168.0.0/16
ðŸ§¾ Roman Urdu: Cluster ko initialize kar rahe hain with Calico compatible CIDR.
________________________________________
âœ… Step 9: kubeconfig Setup for Current User
mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config
ðŸ§¾ Roman Urdu: Normal user ke liye kubectl commands chalanay ke liye config file set kar rahe hain.
________________________________________
âœ… Step 10: Install Calico (CNI Plugin)
kubectl apply -f https://docs.projectcalico.org/manifests/calico.yaml
ðŸ§¾ Roman Urdu: Calico ek networking plugin hai jo pods ke beech communication allow karta hai.
________________________________________
âœ… Step 11: Check Nodes and Pods
kubectl get nodes
kubectl get pods -n kube-system
ðŸ§¾ Roman Urdu: Verify kar rahe hain ke sab pods running mein hain ya nahi.
________________________________________
âœ… Step 12: Install NGINX Ingress Controller
kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.9.1/deploy/static/provider/cloud/deploy.yaml
kubectl get pods -n ingress-nginx
ðŸ§¾ Roman Urdu: Ye ingress controller actual traffic routing handle karta hai Ingress rules ke basis par.
________________________________________
âœ… Step 13: Create Sample Deployments
kubectl create deployment frontend --image=nginx
kubectl expose deployment frontend --port=80 --name=frontend-svc

kubectl create deployment backend --image=nginx
kubectl expose deployment backend --port=80 --name=backend-svc
ðŸ§¾ Roman Urdu: Do simple nginx based apps bana rahe hain frontend aur backend ke liye.
________________________________________
âœ… Step 14: Create Ingress YAML File
multiapp-ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: multiapp-ingress
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  rules:
  - http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: frontend-svc
            port:
              number: 80
      - path: /api
        pathType: Prefix
        backend:
          service:
            name: backend-svc
            port:
              number: 80
ðŸ§¾ Roman Urdu: Ye YAML file define karti hai ke / par frontend aur /api par backend route ho.
________________________________________
âœ… Step 15: Apply Ingress Rule
kubectl apply -f multiapp-ingress.yaml
ðŸ§¾ Roman Urdu: Ingress file ko apply kar rahe hain taake routing rules load ho jaayein.
________________________________________
âœ… Step 16: Test Ingress
kubectl get ingress
kubectl get svc
ðŸ§¾ Roman Urdu: Ingress ka external IP check karo, aur browser se / aur /api test karo.
________________________________________
ðŸ“š Assignment: Practice Multiple App Routing
â€¢	Create 2 deployments: frontend, backend
â€¢	Expose both as services
â€¢	Create Ingress rule:
o	/ â†’ frontend
o	/api â†’ backend
ðŸ§¾ Roman Urdu: Multiple services ko single IP par alag-alag path pe route karna sikho using Ingress.
Ye assignment bhi completed hai all ready
________________________________________
